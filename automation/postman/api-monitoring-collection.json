{
  "info": {
    "_postman_id": "8652919d-4ef5-437b-946c-cec6ce7ba143",
    "name": "Netmonk Prime - API Monitoring",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "Create Monitor",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          },
          {
            "key": "Authorization",
            "value": "{{auth_token}}"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"name\": \"User API Monitor\",\n  \"url\": \"https://api.company.com/user\",\n  \"method\": \"GET\",\n  \"interval\": 60,\n  \"sla_target\": 99\n}",
          "options": {
            "raw": {
              "language": "json"
            }
          }
        },
        "url": {
          "raw": "{{base_url}}/api/monitors",
          "host": ["{{base_url}}"],
          "path": ["api", "monitors"]
        }
      },
      "event": [
        {
          "listen": "prerequest",
          "script": {
            "exec": [
              "if (!pm.environment.get('base_url')) { throw new Error('base_url is not set'); }",
              "pm.environment.set('auth_token', 'Bearer ' + Math.random().toString(36).substring(2));"
            ]
          }
        },
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test('Status 201', function () { pm.response.to.have.status(201); });",
              "var body = pm.response.json();",
              "pm.environment.set('monitor_id', body.id);",
              "pm.test('Monitor ACTIVE', function () { pm.expect(body.status).to.eql('ACTIVE'); });"
            ]
          }
        }
      ]
    },
    {
      "name": "Get Monitor Summary",
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "Authorization",
            "value": "{{auth_token}}"
          }
        ],
        "url": {
          "raw": "{{base_url}}/api/monitors/{{monitor_id}}/summary",
          "host": ["{{base_url}}"],
          "path": ["api", "monitors", "{{monitor_id}}", "summary"]
        }
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test('Status 200', () => pm.response.to.have.status(200));",
              "const json = pm.response.json();",
              "pm.test('Fields present', () => { ['latency_avg','uptime','sla_status','last_check','sla_target'].forEach(f => pm.expect(json).to.have.property(f)); });",
              "pm.test('SLA logic valid', () => { const u=json.uptime; const t=json.sla_target; const exp=u>=t?'GREEN':u>=t-5?'YELLOW':'RED'; pm.expect(json.sla_status).to.eql(exp); });"
            ]
          }
        }
      ]
    }
  ],
  "variable": [
    {
      "key": "base_url",
      "value": "https://api.example.com"
    }
  ]
}
